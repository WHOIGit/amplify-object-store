services:
  object-store:
    build:
      context: .
      dockerfile: Dockerfile
    image: amplify-object-store:latest
    container_name: amplify-object-store

    # Port mapping
    ports:
      - "${HOST_PORT:-8000}:8000"

    # Environment variables
    environment:
      - PORT=8000
      - WORKERS=1
      - LOG_LEVEL=info
      - AUTH_TOKENS_FILE=/data/tokens.json
      # Storage configuration (set in .env to enable)
      - STORAGE_CONFIG=${STORAGE_CONFIG:+/app/storage.yaml}
      - STORAGE_NAME=${STORAGE_NAME}

    # Volume mounts
    volumes:
      # Tokens
      - ${TOKENS_FILE:-./tokens.json}:/data/tokens.json:ro
      # Storage config (mounted if STORAGE_CONFIG is set in .env)
      - ${STORAGE_CONFIG:-/dev/null}:/app/storage.yaml:ro
      # Storage data (for filesystem-based stores)
      - ${STORAGE_PATH:-./data}:/data/objects

    # Restart policy
    restart: unless-stopped
