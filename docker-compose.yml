services:
  object-store:
    build:
      context: .
      dockerfile: Dockerfile
    image: amplify-object-store:latest
    container_name: amplify-object-store

    # Port mapping
    ports:
      - "${HOST_PORT:-8000}:8000"

    # Load all environment variables from .env file
    env_file:
      - .env

    # Container environment variables (these override .env)
    environment:
      # Application settings
      - AUTH_TOKENS_FILE=/app/tokens.json
      - HOST=0.0.0.0
      - PORT=8000
      - WORKERS=${WORKERS:-1}
      - LOG_LEVEL=${LOG_LEVEL:-info}

      # Storage configuration (set in .env to enable)
      # NOTE: Uncomment STORAGE_CONFIG volume mount below in this file to enable.
      - STORAGE_CONFIG=${STORAGE_CONFIG:+/app/storage.yaml}
      - STORAGE_NAME=${STORAGE_NAME}

    # Volume mounts
    volumes:
      # Required: Authentication tokens
      - ${TOKENS_FILE:-./tokens.json}:/app/tokens.json:ro

      # Optional: Uncomment for YAML-based storage config (S3, etc.)
      - ${STORAGE_CONFIG}:/app/storage.yaml:ro

      # Optional: Uncomment for filesystem-based storage
      - ${HOST_STORAGE_PATH}:/data

    # Restart policy
    restart: unless-stopped
